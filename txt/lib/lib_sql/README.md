## lib_sql - SQL formatting functions


### Table Of Contents
<a href="#table-of-contents"></a>
<!-- dev.mdmark  mdmark:MDSECTION  state:BEG_AUTO  param:Toc -->
&nbsp;&nbsp;&bull;&nbsp;  [Functions](#functions)<br/>
&nbsp;&nbsp;&bull;&nbsp;  [Inputs](#inputs)<br/>
&nbsp;&nbsp;&bull;&nbsp;  [Sources](#sources)<br/>
&nbsp;&nbsp;&bull;&nbsp;  [Dependencies](#dependencies)<br/>
&nbsp;&nbsp;&bull;&nbsp;  [In Memory DB](#in-memory-db)<br/>

<!-- dev.mdmark  mdmark:MDSECTION  state:END_AUTO  param:Toc -->

### Functions
<a href="#functions"></a>
<!-- dev.mdmark  mdmark:MDSECTION  state:BEG_AUTO  param:Functions -->
Functions exported from this namespace:

```c++
// SQL-quote string S
// and return result
const tempstr lib_sql::SqlQuoted(strptr s) 
```

```c++
// Return contents of ATTR as a SQL expression in the context of tuple TUPLE.
// The string is properly quoted (i.e. SqlQuoted is not required)
// Translation is controlled with DeclareBool etc.
const tempstr lib_sql::SqlQuotedValue(Tuple &tuple, Attr &attr) 
```

```c++
// Return a comma-separate SQL name-list
const tempstr lib_sql::SqlNames(Tuple &tuple) 
```

```c++
// Return a comma-separate SQL name=value list
const tempstr lib_sql::SqlNameValues(Tuple &tuple) 
```

```c++
// Return a comma-separated SQL value list
tempstr lib_sql::SqlValues(Tuple &tuple) 
```

```c++
// Generate SQL code to insert, delete, or update record STRTUPLE into table TABLENAME,
// Using TSQL 'upsert' trick.
void lib_sql::UpsertOrDelete(strptr strtuple, strptr tablename, cstring &query, bool del) 
```

```c++
// Declare attribute NAME as boolean so it can be translated to SQL Server format
void lib_sql::DeclareBool(strptr name) 
```

<!-- dev.mdmark  mdmark:MDSECTION  state:END_AUTO  param:Functions -->

### Inputs
<a href="#inputs"></a>
<!-- dev.mdmark  mdmark:MDSECTION  state:BEG_AUTO  param:Inputs -->
`lib_sql` takes the following tables on input:
|Ssimfile|Comment|
|---|---|
|[dmmeta.dispsigcheck](/txt/ssimdb/dmmeta/dispsigcheck.md)|Check signature of input data against executable's version|

<!-- dev.mdmark  mdmark:MDSECTION  state:END_AUTO  param:Inputs -->

### Sources
<a href="#sources"></a>
<!-- dev.mdmark  mdmark:MDSECTION  state:BEG_AUTO  param:Sources -->
The source code license is GPL
The following source files are part of this tool:

|Source File|Comment|
|---|---|
|[cpp/gen/lib_sql_gen.cpp](/cpp/gen/lib_sql_gen.cpp)||
|[cpp/lib/lib_sql.cpp](/cpp/lib/lib_sql.cpp)||
|[include/gen/lib_sql_gen.h](/include/gen/lib_sql_gen.h)||
|[include/gen/lib_sql_gen.inl.h](/include/gen/lib_sql_gen.inl.h)||
|[include/lib_sql.h](/include/lib_sql.h)||

<!-- dev.mdmark  mdmark:MDSECTION  state:END_AUTO  param:Sources -->

### Dependencies
<a href="#dependencies"></a>
<!-- dev.mdmark  mdmark:MDSECTION  state:BEG_AUTO  param:Dependencies -->
The build target depends on the following libraries
|Target|Comment|
|---|---|
|[algo_lib](/txt/lib/algo_lib/README.md)|Support library for all executables|

<!-- dev.mdmark  mdmark:MDSECTION  state:END_AUTO  param:Dependencies -->

### In Memory DB
<a href="#in-memory-db"></a>
<!-- dev.mdmark  mdmark:MDSECTION  state:BEG_AUTO  param:Imdb -->
`lib_sql` generated code creates the tables below.
All allocations are done through global `lib_sql::_db` [lib_sql.FDb](#lib_sql-fdb) structure
|Ctype|Ssimfile|Create|Access|
|---|---|---|---|
|[lib_sql.FAttr](#lib_sql-fattr)||FDb.attr (Lary)|attr (Lary, by rowid)|ind_attr (Thash, hash field attr)|
|[lib_sql.FDb](#lib_sql-fdb)||FDb._db (Global)|

#### lib_sql.FAttr - 
<a href="#lib_sql-fattr"></a>

#### lib_sql.FAttr Fields
<a href="#lib_sql-fattr-fields"></a>
|Field|[Type](/txt/ssimdb/dmmeta/ctype.md)|[Reftype](/txt/ssimdb/dmmeta/reftype.md)|Default|Comment|
|---|---|---|---|---|
|lib_sql.FAttr.attr|[algo.cstring](/txt/protocol/algo/cstring.md)|[Val](/txt/exe/amc/reftypes.md#val)|||
|lib_sql.FAttr.isbool|bool|[Val](/txt/exe/amc/reftypes.md#val)|||

#### Struct FAttr
<a href="#struct-fattr"></a>
Generated by [amc](/txt/exe/amc/README.md) into [include/gen/lib_sql_gen.h](/include/gen/lib_sql_gen.h)
```
struct FAttr { // lib_sql.FAttr
    algo::cstring     attr;            //
    bool              isbool;          //   false
    lib_sql::FAttr*   ind_attr_next;   // hash next
    // func:lib_sql.FAttr..AssignOp
    inline lib_sql::FAttr& operator =(const lib_sql::FAttr &rhs) = delete;
    // func:lib_sql.FAttr..CopyCtor
    inline               FAttr(const lib_sql::FAttr &rhs) = delete;
private:
    // func:lib_sql.FAttr..Ctor
    inline               FAttr() __attribute__((nothrow));
    // func:lib_sql.FAttr..Dtor
    inline               ~FAttr() __attribute__((nothrow));
    friend lib_sql::FAttr&      attr_Alloc() __attribute__((__warn_unused_result__, nothrow));
    friend lib_sql::FAttr*      attr_AllocMaybe() __attribute__((__warn_unused_result__, nothrow));
    friend void                 attr_RemoveAll() __attribute__((nothrow));
    friend void                 attr_RemoveLast() __attribute__((nothrow));
};
```

#### lib_sql.FDb - In-memory database for lib_sql
<a href="#lib_sql-fdb"></a>

#### lib_sql.FDb Fields
<a href="#lib_sql-fdb-fields"></a>
|Field|[Type](/txt/ssimdb/dmmeta/ctype.md)|[Reftype](/txt/ssimdb/dmmeta/reftype.md)|Default|Comment|
|---|---|---|---|---|
|lib_sql.FDb._db|[lib_sql.FDb](/txt/lib/lib_sql/README.md#lib_sql-fdb)|[Global](/txt/exe/amc/reftypes.md#global)|||
|lib_sql.FDb.attr|[lib_sql.FAttr](/txt/lib/lib_sql/README.md#lib_sql-fattr)|[Lary](/txt/exe/amc/reftypes.md#lary)|||
|lib_sql.FDb.ind_attr|[lib_sql.FAttr](/txt/lib/lib_sql/README.md#lib_sql-fattr)|[Thash](/txt/exe/amc/reftypes.md#thash)|||

#### Struct FDb
<a href="#struct-fdb"></a>
Generated by [amc](/txt/exe/amc/README.md) into [include/gen/lib_sql_gen.h](/include/gen/lib_sql_gen.h)
```
struct FDb { // lib_sql.FDb: In-memory database for lib_sql
    lib_sql::FAttr*    attr_lary[32];            // level array
    i32                attr_n;                   // number of elements in array
    lib_sql::FAttr**   ind_attr_buckets_elems;   // pointer to bucket array
    i32                ind_attr_buckets_n;       // number of elements in bucket array
    i32                ind_attr_n;               // number of elements in the hash table
    lib_sql::trace     trace;                    //
};
```

<!-- dev.mdmark  mdmark:MDSECTION  state:END_AUTO  param:Imdb -->

