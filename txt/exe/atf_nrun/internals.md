## atf_nrun - Internals


### Table Of Contents
<a href="#table-of-contents"></a>
<!-- dev.mdmark  mdmark:MDSECTION  state:BEG_AUTO  param:Toc -->
* [Description](#description)
* [Sources](#sources)
* [Dependencies](#dependencies)
* [In Memory DB](#in-memory-db)

<!-- dev.mdmark  mdmark:MDSECTION  state:END_AUTO  param:Toc -->

### Description
<a href="#description"></a>
<!-- dev.mdmark  mdmark:MDSECTION  state:BEG_AUTO  param:Description -->
for usage, see [atf_nrun - Run N subprocesses in parallel](/txt/exe/atf_nrun/README.md)

<!-- dev.mdmark  mdmark:MDSECTION  state:END_AUTO  param:Description -->

### Sources
<a href="#sources"></a>
<!-- dev.mdmark  mdmark:MDSECTION  state:BEG_AUTO  param:Sources -->
The source code license is GPL
The following source files are part of this tool:

|Source File|Comment|
|---|---|
|[cpp/atf_nrun/atf_nrun.cpp](/cpp/atf_nrun/atf_nrun.cpp)||
|[cpp/gen/atf_nrun_gen.cpp](/cpp/gen/atf_nrun_gen.cpp)||
|[include/atf_nrun.h](/include/atf_nrun.h)||
|[include/gen/atf_nrun_gen.h](/include/gen/atf_nrun_gen.h)||
|[include/gen/atf_nrun_gen.inl.h](/include/gen/atf_nrun_gen.inl.h)||

<!-- dev.mdmark  mdmark:MDSECTION  state:END_AUTO  param:Sources -->

### Dependencies
<a href="#dependencies"></a>
<!-- dev.mdmark  mdmark:MDSECTION  state:BEG_AUTO  param:Dependencies -->
The build target depends on the following libraries
|Target|Comment|
|---|---|
|[algo_lib](/txt/lib/algo_lib/README.md)|Support library for all executables|

<!-- dev.mdmark  mdmark:MDSECTION  state:END_AUTO  param:Dependencies -->

### In Memory DB
<a href="#in-memory-db"></a>
<!-- dev.mdmark  mdmark:MDSECTION  state:BEG_AUTO  param:Imdb -->
`atf_nrun` generated code creates the tables below.
All allocations are done through global `atf_nrun::_db` [atf_nrun.FDb](#atf_nrun-fdb) structure
|Ctype|Ssimfile|Create|Access|
|---|---|---|---|
|[atf_nrun.FDb](#atf_nrun-fdb)||FDb._db (Global)|
|[atf_nrun.FEntry](#atf_nrun-fentry)||FDb.fentry (Lary)|fentry (Lary, by rowid)|ind_running (Thash, hash field pid)|zd_todo (Llist)|

#### atf_nrun.FDb - In-memory database for atf_nrun
<a href="#atf_nrun-fdb"></a>

#### atf_nrun.FDb Fields
<a href="#atf_nrun-fdb-fields"></a>
|Field|[Type](/txt/ssimdb/dmmeta/ctype.md)|[Reftype](/txt/ssimdb/dmmeta/reftype.md)|Default|Comment|
|---|---|---|---|---|
|atf_nrun.FDb._db|[atf_nrun.FDb](/txt/exe/atf_nrun/internals.md#atf_nrun-fdb)|[Global](/txt/exe/amc/reftypes.md#global)|||
|atf_nrun.FDb.cmdline|[command.atf_nrun](/txt/protocol/command/README.md#command-atf_nrun)|[Val](/txt/exe/amc/reftypes.md#val)|||
|atf_nrun.FDb.fentry|[atf_nrun.FEntry](/txt/exe/atf_nrun/internals.md#atf_nrun-fentry)|[Lary](/txt/exe/amc/reftypes.md#lary)||List of jobs|
|atf_nrun.FDb.ind_running|[atf_nrun.FEntry](/txt/exe/atf_nrun/internals.md#atf_nrun-fentry)|[Thash](/txt/exe/amc/reftypes.md#thash)||Running job|
|atf_nrun.FDb.zd_todo|[atf_nrun.FEntry](/txt/exe/atf_nrun/internals.md#atf_nrun-fentry)|[Llist](/txt/exe/amc/reftypes.md#llist)||Remaining to dos|

#### Struct FDb
<a href="#struct-fdb"></a>
Generated by [amc](/txt/exe/amc/README.md) into [include/gen/atf_nrun_gen.h](/include/gen/atf_nrun_gen.h)
```
struct FDb { // atf_nrun.FDb: In-memory database for atf_nrun
    command::atf_nrun    cmdline;                     //
    atf_nrun::FEntry*    fentry_lary[32];             // level array
    i32                  fentry_n;                    // number of elements in array
    atf_nrun::FEntry**   ind_running_buckets_elems;   // pointer to bucket array
    i32                  ind_running_buckets_n;       // number of elements in bucket array
    i32                  ind_running_n;               // number of elements in the hash table
    algo::SchedTime      ind_running_next;            // atf_nrun.FDb.ind_running              Next invocation time
    algo::SchedTime      ind_running_delay;           // atf_nrun.FDb.ind_running              Delay between invocations
    atf_nrun::FEntry*    zd_todo_head;                // zero-terminated doubly linked list
    i32                  zd_todo_n;                   // zero-terminated doubly linked list
    atf_nrun::FEntry*    zd_todo_tail;                // pointer to last element
    algo::SchedTime      zd_todo_next;                // atf_nrun.FDb.zd_todo                  Next invocation time
    algo::SchedTime      zd_todo_delay;               // atf_nrun.FDb.zd_todo                  Delay between invocations
    atf_nrun::trace      trace;                       //
};
```

#### atf_nrun.FEntry - 
<a href="#atf_nrun-fentry"></a>

#### atf_nrun.FEntry Fields
<a href="#atf_nrun-fentry-fields"></a>
|Field|[Type](/txt/ssimdb/dmmeta/ctype.md)|[Reftype](/txt/ssimdb/dmmeta/reftype.md)|Default|Comment|
|---|---|---|---|---|
|atf_nrun.FEntry.command|[algo.cstring](/txt/protocol/algo/cstring.md)|[Val](/txt/exe/amc/reftypes.md#val)||Command to execute|
|atf_nrun.FEntry.pid|i32|[Val](/txt/exe/amc/reftypes.md#val)||Pid of running bash job|
|atf_nrun.FEntry.job|[command.bash](/txt/protocol/command/README.md#command-bash)|[Exec](/txt/exe/amc/reftypes.md#exec)||Subprocess|

#### Struct FEntry
<a href="#struct-fentry"></a>
Generated by [amc](/txt/exe/amc/README.md) into [include/gen/atf_nrun_gen.h](/include/gen/atf_nrun_gen.h)
```
struct FEntry { // atf_nrun.FEntry
    atf_nrun::FEntry*   ind_running_next;   // hash next
    atf_nrun::FEntry*   zd_todo_next;       // zslist link; -1 means not-in-list
    atf_nrun::FEntry*   zd_todo_prev;       // previous element
    algo::cstring       command;            // Command to execute
    i32                 pid;                //   0  Pid of running bash job
    algo::cstring       job_path;           //   "bin/bash"  path for executable
    command::bash       job_cmd;            // command line for child process
    algo::cstring       job_fstdin;         // redirect for stdin
    algo::cstring       job_fstdout;        // redirect for stdout
    algo::cstring       job_fstderr;        // redirect for stderr
    pid_t               job_pid;            //   0  pid of running child process
    i32                 job_timeout;        //   0  optional timeout for child process
    i32                 job_status;         //   0  last exit status of child process
    // reftype Exec of atf_nrun.FEntry.job prohibits copy
    // func:atf_nrun.FEntry..AssignOp
    atf_nrun::FEntry&    operator =(const atf_nrun::FEntry &rhs) = delete;
    // reftype Exec of atf_nrun.FEntry.job prohibits copy
    // func:atf_nrun.FEntry..CopyCtor
    FEntry(const atf_nrun::FEntry &rhs) = delete;
private:
    // func:atf_nrun.FEntry..Ctor
    inline               FEntry() __attribute__((nothrow));
    // func:atf_nrun.FEntry..Dtor
    inline               ~FEntry() __attribute__((nothrow));
    friend atf_nrun::FEntry&    fentry_Alloc() __attribute__((__warn_unused_result__, nothrow));
    friend atf_nrun::FEntry*    fentry_AllocMaybe() __attribute__((__warn_unused_result__, nothrow));
    friend void                 fentry_RemoveAll() __attribute__((nothrow));
    friend void                 fentry_RemoveLast() __attribute__((nothrow));
};
```

<!-- dev.mdmark  mdmark:MDSECTION  state:END_AUTO  param:Imdb -->

