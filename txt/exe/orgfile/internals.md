## orgfile - Internals


### Table Of Contents
<a href="#table-of-contents"></a>
<!-- dev.mdmark  mdmark:MDSECTION  state:BEG_AUTO  param:Toc -->
* [Description](#description)
* [Sources](#sources)
* [Dependencies](#dependencies)
* [In Memory DB](#in-memory-db)

<!-- dev.mdmark  mdmark:MDSECTION  state:END_AUTO  param:Toc -->

### Description
<a href="#description"></a>
<!-- dev.mdmark  mdmark:MDSECTION  state:BEG_AUTO  param:Description -->
for usage, see [orgfile - Organize and deduplicate files by timestamp and by contents](/txt/exe/orgfile/README.md)

<!-- dev.mdmark  mdmark:MDSECTION  state:END_AUTO  param:Description -->

### Sources
<a href="#sources"></a>
<!-- dev.mdmark  mdmark:MDSECTION  state:BEG_AUTO  param:Sources -->
The source code license is GPL
The following source files are part of this tool:

|Source File|Comment|
|---|---|
|[cpp/gen/orgfile_gen.cpp](/cpp/gen/orgfile_gen.cpp)||
|[cpp/orgfile.cpp](/cpp/orgfile.cpp)||
|[include/gen/orgfile_gen.h](/include/gen/orgfile_gen.h)||
|[include/gen/orgfile_gen.inl.h](/include/gen/orgfile_gen.inl.h)||
|[include/orgfile.h](/include/orgfile.h)||

<!-- dev.mdmark  mdmark:MDSECTION  state:END_AUTO  param:Sources -->

### Dependencies
<a href="#dependencies"></a>
<!-- dev.mdmark  mdmark:MDSECTION  state:BEG_AUTO  param:Dependencies -->
The build target depends on the following libraries
|Target|Comment|
|---|---|
|[algo_lib](/txt/lib/algo_lib/README.md)|Support library for all executables|

<!-- dev.mdmark  mdmark:MDSECTION  state:END_AUTO  param:Dependencies -->

### In Memory DB
<a href="#in-memory-db"></a>
<!-- dev.mdmark  mdmark:MDSECTION  state:BEG_AUTO  param:Imdb -->
`orgfile` generated code creates the tables below.
All allocations are done through global `orgfile::_db` [orgfile.FDb](#orgfile-fdb) structure
|Ctype|Ssimfile|Create|Access|
|---|---|---|---|
|[orgfile.FDb](#orgfile-fdb)||FDb._db (Global)|
|[orgfile.FFilehash](#orgfile-ffilehash)||FDb.filehash (Lary)|filehash (Lary, by rowid)|ind_filehash (Thash, hash field filehash)|
||||FFilename.p_filehash (Upptr)|
|[orgfile.FFilename](#orgfile-ffilename)||FDb.filename (Tpool)|ind_filename (Thash, hash field filename)|
||||FFilehash.c_filename (Ptrary)|
|[orgfile.FTimefmt](#orgfile-ftimefmt)|[dev.timefmt](/txt/ssimdb/dev/timefmt.md)|FDb.timefmt (Lary)|timefmt (Lary, by rowid)|
|[orgfile.dedup](#orgfile-dedup)||
|[orgfile.move](#orgfile-move)||

#### orgfile.FDb - In-memory database for orgfile
<a href="#orgfile-fdb"></a>

#### orgfile.FDb Fields
<a href="#orgfile-fdb-fields"></a>
|Field|[Type](/txt/ssimdb/dmmeta/ctype.md)|[Reftype](/txt/ssimdb/dmmeta/reftype.md)|Default|Comment|
|---|---|---|---|---|
|orgfile.FDb._db|[orgfile.FDb](/txt/exe/orgfile/internals.md#orgfile-fdb)|[Global](/txt/exe/amc/reftypes.md#global)|||
|orgfile.FDb.cmdline|[command.orgfile](/txt/protocol/command/README.md#command-orgfile)|[Val](/txt/exe/amc/reftypes.md#val)|||
|orgfile.FDb.filename|[orgfile.FFilename](/txt/exe/orgfile/internals.md#orgfile-ffilename)|[Tpool](/txt/exe/amc/reftypes.md#tpool)|||
|orgfile.FDb.ind_filename|[orgfile.FFilename](/txt/exe/orgfile/internals.md#orgfile-ffilename)|[Thash](/txt/exe/amc/reftypes.md#thash)|||
|orgfile.FDb.filehash|[orgfile.FFilehash](/txt/exe/orgfile/internals.md#orgfile-ffilehash)|[Lary](/txt/exe/amc/reftypes.md#lary)|||
|orgfile.FDb.ind_filehash|[orgfile.FFilehash](/txt/exe/orgfile/internals.md#orgfile-ffilehash)|[Thash](/txt/exe/amc/reftypes.md#thash)|||
|orgfile.FDb.timefmt|[orgfile.FTimefmt](/txt/exe/orgfile/internals.md#orgfile-ftimefmt)|[Lary](/txt/exe/amc/reftypes.md#lary)|||

#### Struct FDb
<a href="#struct-fdb"></a>
Generated by [amc](/txt/exe/amc/README.md) into [include/gen/orgfile_gen.h](/include/gen/orgfile_gen.h)
```
struct FDb { // orgfile.FDb: In-memory database for orgfile
    command::orgfile       cmdline;                      //
    u64                    filename_blocksize;           // # bytes per block
    orgfile::FFilename*    filename_free;                //
    orgfile::FFilename**   ind_filename_buckets_elems;   // pointer to bucket array
    i32                    ind_filename_buckets_n;       // number of elements in bucket array
    i32                    ind_filename_n;               // number of elements in the hash table
    orgfile::FFilehash*    filehash_lary[32];            // level array
    i32                    filehash_n;                   // number of elements in array
    orgfile::FFilehash**   ind_filehash_buckets_elems;   // pointer to bucket array
    i32                    ind_filehash_buckets_n;       // number of elements in bucket array
    i32                    ind_filehash_n;               // number of elements in the hash table
    orgfile::FTimefmt*     timefmt_lary[32];             // level array
    i32                    timefmt_n;                    // number of elements in array
    orgfile::trace         trace;                        //
};
```

#### orgfile.FFilehash - 
<a href="#orgfile-ffilehash"></a>

#### orgfile.FFilehash Fields
<a href="#orgfile-ffilehash-fields"></a>
|Field|[Type](/txt/ssimdb/dmmeta/ctype.md)|[Reftype](/txt/ssimdb/dmmeta/reftype.md)|Default|Comment|
|---|---|---|---|---|
|orgfile.FFilehash.filehash|[algo.Smallstr40](/txt/protocol/algo/README.md#algo-smallstr40)|[Val](/txt/exe/amc/reftypes.md#val)|||
|orgfile.FFilehash.c_filename|[orgfile.FFilename](/txt/exe/orgfile/internals.md#orgfile-ffilename)|[Ptrary](/txt/exe/amc/reftypes.md#ptrary)|||

#### Struct FFilehash
<a href="#struct-ffilehash"></a>
Generated by [amc](/txt/exe/amc/README.md) into [include/gen/orgfile_gen.h](/include/gen/orgfile_gen.h)
```
struct FFilehash { // orgfile.FFilehash
    orgfile::FFilehash*    ind_filehash_next;   // hash next
    algo::Smallstr40       filehash;            //
    orgfile::FFilename**   c_filename_elems;    // array of pointers
    u32                    c_filename_n;        // array of pointers
    u32                    c_filename_max;      // capacity of allocated array
    // reftype Ptrary of orgfile.FFilehash.c_filename prohibits copy
    // func:orgfile.FFilehash..AssignOp
    inline orgfile::FFilehash& operator =(const orgfile::FFilehash &rhs) = delete;
    // reftype Ptrary of orgfile.FFilehash.c_filename prohibits copy
    // func:orgfile.FFilehash..CopyCtor
    inline               FFilehash(const orgfile::FFilehash &rhs) = delete;
private:
    // func:orgfile.FFilehash..Ctor
    inline               FFilehash() __attribute__((nothrow));
    // func:orgfile.FFilehash..Dtor
    inline               ~FFilehash() __attribute__((nothrow));
    friend orgfile::FFilehash&  filehash_Alloc() __attribute__((__warn_unused_result__, nothrow));
    friend orgfile::FFilehash*  filehash_AllocMaybe() __attribute__((__warn_unused_result__, nothrow));
    friend void                 filehash_RemoveAll() __attribute__((nothrow));
    friend void                 filehash_RemoveLast() __attribute__((nothrow));
};
```

#### orgfile.FFilename - 
<a href="#orgfile-ffilename"></a>

#### orgfile.FFilename Fields
<a href="#orgfile-ffilename-fields"></a>
|Field|[Type](/txt/ssimdb/dmmeta/ctype.md)|[Reftype](/txt/ssimdb/dmmeta/reftype.md)|Default|Comment|
|---|---|---|---|---|
|orgfile.FFilename.filename|[algo.cstring](/txt/protocol/algo/cstring.md)|[Val](/txt/exe/amc/reftypes.md#val)|||
|orgfile.FFilename.filehash|[orgfile.FFilehash](/txt/exe/orgfile/internals.md#orgfile-ffilehash)|[Pkey](/txt/exe/amc/reftypes.md#pkey)|||
|orgfile.FFilename.p_filehash|[orgfile.FFilehash](/txt/exe/orgfile/internals.md#orgfile-ffilehash)|[Upptr](/txt/exe/amc/reftypes.md#upptr)|||

#### Struct FFilename
<a href="#struct-ffilename"></a>
Generated by [amc](/txt/exe/amc/README.md) into [include/gen/orgfile_gen.h](/include/gen/orgfile_gen.h)
```
struct FFilename { // orgfile.FFilename
    orgfile::FFilename*   filename_next;                // Pointer to next free element int tpool
    orgfile::FFilename*   ind_filename_next;            // hash next
    algo::cstring         filename;                     //
    algo::Smallstr40      filehash;                     //
    orgfile::FFilehash*   p_filehash;                   // reference to parent row
    bool                  filehash_c_filename_in_ary;   //   false  membership flag
    // x-reference on orgfile.FFilename.p_filehash prevents copy
    // func:orgfile.FFilename..AssignOp
    inline orgfile::FFilename& operator =(const orgfile::FFilename &rhs) = delete;
    // x-reference on orgfile.FFilename.p_filehash prevents copy
    // func:orgfile.FFilename..CopyCtor
    inline               FFilename(const orgfile::FFilename &rhs) = delete;
private:
    // func:orgfile.FFilename..Ctor
    inline               FFilename() __attribute__((nothrow));
    // func:orgfile.FFilename..Dtor
    inline               ~FFilename() __attribute__((nothrow));
    friend orgfile::FFilename&  filename_Alloc() __attribute__((__warn_unused_result__, nothrow));
    friend orgfile::FFilename*  filename_AllocMaybe() __attribute__((__warn_unused_result__, nothrow));
    friend void                 filename_Delete(orgfile::FFilename &row) __attribute__((nothrow));
};
```

#### orgfile.FTimefmt - Time formats supported by orgfile
<a href="#orgfile-ftimefmt"></a>

#### orgfile.FTimefmt Fields
<a href="#orgfile-ftimefmt-fields"></a>
|Field|[Type](/txt/ssimdb/dmmeta/ctype.md)|[Reftype](/txt/ssimdb/dmmeta/reftype.md)|Default|Comment|
|---|---|---|---|---|
|orgfile.FTimefmt.base|[dev.Timefmt](/txt/ssimdb/dev/timefmt.md)|[Base](/txt/ssimdb/dev/timefmt.md)|||

#### Struct FTimefmt
<a href="#struct-ftimefmt"></a>
*Note:* field ``orgfile.FTimefmt.base`` has reftype ``base`` so the fields of [dev.Timefmt](/txt/ssimdb/dev/timefmt.md) above are included into the resulting struct.

Generated by [amc](/txt/exe/amc/README.md) into [include/gen/orgfile_gen.h](/include/gen/orgfile_gen.h)
```
struct FTimefmt { // orgfile.FTimefmt
    algo::Smallstr100   timefmt;   //
    bool                dirname;   //   false
    algo::Comment       comment;   //
private:
    // func:orgfile.FTimefmt..Ctor
    inline               FTimefmt() __attribute__((nothrow));
    friend orgfile::FTimefmt&   timefmt_Alloc() __attribute__((__warn_unused_result__, nothrow));
    friend orgfile::FTimefmt*   timefmt_AllocMaybe() __attribute__((__warn_unused_result__, nothrow));
    friend void                 timefmt_RemoveAll() __attribute__((nothrow));
    friend void                 timefmt_RemoveLast() __attribute__((nothrow));
};
```

#### orgfile.dedup - 
<a href="#orgfile-dedup"></a>

#### orgfile.dedup Fields
<a href="#orgfile-dedup-fields"></a>
|Field|[Type](/txt/ssimdb/dmmeta/ctype.md)|[Reftype](/txt/ssimdb/dmmeta/reftype.md)|Default|Comment|
|---|---|---|---|---|
|orgfile.dedup.original|[algo.cstring](/txt/protocol/algo/cstring.md)|[Val](/txt/exe/amc/reftypes.md#val)|||
|orgfile.dedup.duplicate|[algo.cstring](/txt/protocol/algo/cstring.md)|[Val](/txt/exe/amc/reftypes.md#val)|||
|orgfile.dedup.comment|[algo.cstring](/txt/protocol/algo/cstring.md)|[Val](/txt/exe/amc/reftypes.md#val)|||

#### Struct dedup
<a href="#struct-dedup"></a>
Generated by [amc](/txt/exe/amc/README.md) into [include/gen/orgfile_gen.h](/include/gen/orgfile_gen.h)
```
struct dedup { // orgfile.dedup
    algo::cstring   original;    //
    algo::cstring   duplicate;   //
    algo::cstring   comment;     //
    // func:orgfile.dedup..Ctor
    inline               dedup() __attribute__((nothrow));
};
```

#### orgfile.move - 
<a href="#orgfile-move"></a>

#### orgfile.move Fields
<a href="#orgfile-move-fields"></a>
|Field|[Type](/txt/ssimdb/dmmeta/ctype.md)|[Reftype](/txt/ssimdb/dmmeta/reftype.md)|Default|Comment|
|---|---|---|---|---|
|orgfile.move.pathname|[algo.cstring](/txt/protocol/algo/cstring.md)|[Val](/txt/exe/amc/reftypes.md#val)|||
|orgfile.move.tgtfile|[algo.cstring](/txt/protocol/algo/cstring.md)|[Val](/txt/exe/amc/reftypes.md#val)|||
|orgfile.move.comment|[algo.cstring](/txt/protocol/algo/cstring.md)|[Val](/txt/exe/amc/reftypes.md#val)|||

#### Struct move
<a href="#struct-move"></a>
Generated by [amc](/txt/exe/amc/README.md) into [include/gen/orgfile_gen.h](/include/gen/orgfile_gen.h)
```
struct move { // orgfile.move
    algo::cstring   pathname;   //
    algo::cstring   tgtfile;    //
    algo::cstring   comment;    //
    // func:orgfile.move..Ctor
    inline               move() __attribute__((nothrow));
};
```

<!-- dev.mdmark  mdmark:MDSECTION  state:END_AUTO  param:Imdb -->

