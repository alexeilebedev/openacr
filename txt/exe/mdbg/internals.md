## mdbg - Internals


### Table Of Contents
<a href="#table-of-contents"></a>
<!-- dev.mdmark  mdmark:MDSECTION  state:BEG_AUTO  param:Toc -->
* [Description](#description)
* [Sources](#sources)
* [Dependencies](#dependencies)
* [In Memory DB](#in-memory-db)
* [Tests](#tests)

<!-- dev.mdmark  mdmark:MDSECTION  state:END_AUTO  param:Toc -->

### Description
<a href="#description"></a>
<!-- dev.mdmark  mdmark:MDSECTION  state:BEG_AUTO  param:Description -->
for usage, see [mdbg - Gdb front-end](/txt/exe/mdbg/README.md)

<!-- dev.mdmark  mdmark:MDSECTION  state:END_AUTO  param:Description -->

### Sources
<a href="#sources"></a>
<!-- dev.mdmark  mdmark:MDSECTION  state:BEG_AUTO  param:Sources -->
The source code license is GPL
The following source files are part of this tool:

|Source File|Comment|
|---|---|
|[cpp/gen/mdbg_gen.cpp](/cpp/gen/mdbg_gen.cpp)||
|[cpp/mdbg/mdbg.cpp](/cpp/mdbg/mdbg.cpp)||
|[include/gen/mdbg_gen.h](/include/gen/mdbg_gen.h)||
|[include/gen/mdbg_gen.inl.h](/include/gen/mdbg_gen.inl.h)||

<!-- dev.mdmark  mdmark:MDSECTION  state:END_AUTO  param:Sources -->

### Dependencies
<a href="#dependencies"></a>
<!-- dev.mdmark  mdmark:MDSECTION  state:BEG_AUTO  param:Dependencies -->
The build target depends on the following libraries
|Target|Comment|
|---|---|
|[algo_lib](/txt/lib/algo_lib/README.md)|Support library for all executables|

<!-- dev.mdmark  mdmark:MDSECTION  state:END_AUTO  param:Dependencies -->

### In Memory DB
<a href="#in-memory-db"></a>
<!-- dev.mdmark  mdmark:MDSECTION  state:BEG_AUTO  param:Imdb -->
`mdbg` generated code creates the tables below.
All allocations are done through global `mdbg::_db` [mdbg.FDb](#mdbg-fdb) structure
|Ctype|Ssimfile|Create|Access|
|---|---|---|---|
|[mdbg.FBuilddir](#mdbg-fbuilddir)|[dev.builddir](/txt/ssimdb/dev/builddir.md)|FDb.builddir (Lary)|builddir (Lary, by rowid)|
||||FCfg.c_builddir (Ptrary)|
|[mdbg.FCfg](#mdbg-fcfg)|[dev.cfg](/txt/ssimdb/dev/cfg.md)|FDb.cfg (Lary)|cfg (Lary, by rowid)|ind_cfg (Thash, hash field cfg)|
|[mdbg.FDb](#mdbg-fdb)||FDb._db (Global)|

#### mdbg.FBuilddir - Directory where object files/executables go. Determines compile/link options
<a href="#mdbg-fbuilddir"></a>

#### mdbg.FBuilddir Fields
<a href="#mdbg-fbuilddir-fields"></a>
|Field|[Type](/txt/ssimdb/dmmeta/ctype.md)|[Reftype](/txt/ssimdb/dmmeta/reftype.md)|Default|Comment|
|---|---|---|---|---|
|mdbg.FBuilddir.base|[dev.Builddir](/txt/ssimdb/dev/builddir.md)|[Base](/txt/ssimdb/dev/builddir.md)|||

#### Struct FBuilddir
<a href="#struct-fbuilddir"></a>
*Note:* field ``mdbg.FBuilddir.base`` has reftype ``base`` so the fields of [dev.Builddir](/txt/ssimdb/dev/builddir.md) above are included into the resulting struct.

Generated by [amc](/txt/exe/amc/README.md) into [include/gen/mdbg_gen.h](/include/gen/mdbg_gen.h)
```
struct FBuilddir { // mdbg.FBuilddir
    algo::Smallstr50   builddir;                // Primary key - uname.compiler.cfg-arch
    algo::Comment      comment;                 //
    bool               cfg_c_builddir_in_ary;   //   false  membership flag
    // func:mdbg.FBuilddir..AssignOp
    inline mdbg::FBuilddir& operator =(const mdbg::FBuilddir &rhs) = delete;
    // func:mdbg.FBuilddir..CopyCtor
    inline               FBuilddir(const mdbg::FBuilddir &rhs) = delete;
private:
    // func:mdbg.FBuilddir..Ctor
    inline               FBuilddir() __attribute__((nothrow));
    // func:mdbg.FBuilddir..Dtor
    inline               ~FBuilddir() __attribute__((nothrow));
    friend mdbg::FBuilddir&     builddir_Alloc() __attribute__((__warn_unused_result__, nothrow));
    friend mdbg::FBuilddir*     builddir_AllocMaybe() __attribute__((__warn_unused_result__, nothrow));
    friend void                 builddir_RemoveAll() __attribute__((nothrow));
    friend void                 builddir_RemoveLast() __attribute__((nothrow));
};
```

#### mdbg.FCfg - Compiler configuration
<a href="#mdbg-fcfg"></a>

#### mdbg.FCfg Fields
<a href="#mdbg-fcfg-fields"></a>
|Field|[Type](/txt/ssimdb/dmmeta/ctype.md)|[Reftype](/txt/ssimdb/dmmeta/reftype.md)|Default|Comment|
|---|---|---|---|---|
|mdbg.FCfg.base|[dev.Cfg](/txt/ssimdb/dev/cfg.md)|[Base](/txt/ssimdb/dev/cfg.md)|||
|mdbg.FCfg.c_builddir|[mdbg.FBuilddir](/txt/exe/mdbg/internals.md#mdbg-fbuilddir)|[Ptrary](/txt/exe/amc/reftypes.md#ptrary)|||

#### Struct FCfg
<a href="#struct-fcfg"></a>
*Note:* field ``mdbg.FCfg.base`` has reftype ``base`` so the fields of [dev.Cfg](/txt/ssimdb/dev/cfg.md) above are included into the resulting struct.

Generated by [amc](/txt/exe/amc/README.md) into [include/gen/mdbg_gen.h](/include/gen/mdbg_gen.h)
```
struct FCfg { // mdbg.FCfg
    algo::Smallstr50    cfg;                //
    algo::Smallstr5     suffix;             //
    algo::Comment       comment;            //
    mdbg::FBuilddir**   c_builddir_elems;   // array of pointers
    u32                 c_builddir_n;       // array of pointers
    u32                 c_builddir_max;     // capacity of allocated array
    mdbg::FCfg*         ind_cfg_next;       // hash next
    // reftype Ptrary of mdbg.FCfg.c_builddir prohibits copy
    // func:mdbg.FCfg..AssignOp
    inline mdbg::FCfg&   operator =(const mdbg::FCfg &rhs) = delete;
    // reftype Ptrary of mdbg.FCfg.c_builddir prohibits copy
    // func:mdbg.FCfg..CopyCtor
    inline               FCfg(const mdbg::FCfg &rhs) = delete;
private:
    // func:mdbg.FCfg..Ctor
    inline               FCfg() __attribute__((nothrow));
    // func:mdbg.FCfg..Dtor
    inline               ~FCfg() __attribute__((nothrow));
    friend mdbg::FCfg&          cfg_Alloc() __attribute__((__warn_unused_result__, nothrow));
    friend mdbg::FCfg*          cfg_AllocMaybe() __attribute__((__warn_unused_result__, nothrow));
    friend void                 cfg_RemoveAll() __attribute__((nothrow));
    friend void                 cfg_RemoveLast() __attribute__((nothrow));
};
```

#### mdbg.FDb - In-memory database for mdbg
<a href="#mdbg-fdb"></a>

#### mdbg.FDb Fields
<a href="#mdbg-fdb-fields"></a>
|Field|[Type](/txt/ssimdb/dmmeta/ctype.md)|[Reftype](/txt/ssimdb/dmmeta/reftype.md)|Default|Comment|
|---|---|---|---|---|
|mdbg.FDb.lpool|u8|[Lpool](/txt/exe/amc/reftypes.md#lpool)||private memory pool|
|mdbg.FDb._db|[mdbg.FDb](/txt/exe/mdbg/internals.md#mdbg-fdb)|[Global](/txt/exe/amc/reftypes.md#global)|||
|mdbg.FDb.cmdline|[command.mdbg](/txt/protocol/command/README.md#command-mdbg)|[Val](/txt/exe/amc/reftypes.md#val)|||
|mdbg.FDb.script|[algo.cstring](/txt/protocol/algo/cstring.md)|[Val](/txt/exe/amc/reftypes.md#val)||Output script|
|mdbg.FDb.gdbscript|[algo.cstring](/txt/protocol/algo/cstring.md)|[Val](/txt/exe/amc/reftypes.md#val)||GDB script|
|mdbg.FDb.cfg|[mdbg.FCfg](/txt/exe/mdbg/internals.md#mdbg-fcfg)|[Lary](/txt/exe/amc/reftypes.md#lary)|||
|mdbg.FDb.ind_cfg|[mdbg.FCfg](/txt/exe/mdbg/internals.md#mdbg-fcfg)|[Thash](/txt/exe/amc/reftypes.md#thash)|||
|mdbg.FDb.builddir|[mdbg.FBuilddir](/txt/exe/mdbg/internals.md#mdbg-fbuilddir)|[Lary](/txt/exe/amc/reftypes.md#lary)|||
|mdbg.FDb.break_main|bool|[Val](/txt/exe/amc/reftypes.md#val)||Breakpoint in main was requested at command line|
|mdbg.FDb.bnum|i32|[Val](/txt/exe/amc/reftypes.md#val)|1|Breakpoint number for gdb|

#### Struct FDb
<a href="#struct-fdb"></a>
Generated by [amc](/txt/exe/amc/README.md) into [include/gen/mdbg_gen.h](/include/gen/mdbg_gen.h)
```
struct FDb { // mdbg.FDb: In-memory database for mdbg
    lpool_Lpblock*     lpool_free[36];          // Lpool levels
    command::mdbg      cmdline;                 //
    algo::cstring      script;                  // Output script
    algo::cstring      gdbscript;               // GDB script
    mdbg::FCfg*        cfg_lary[32];            // level array
    i32                cfg_n;                   // number of elements in array
    mdbg::FCfg**       ind_cfg_buckets_elems;   // pointer to bucket array
    i32                ind_cfg_buckets_n;       // number of elements in bucket array
    i32                ind_cfg_n;               // number of elements in the hash table
    mdbg::FBuilddir*   builddir_lary[32];       // level array
    i32                builddir_n;              // number of elements in array
    bool               break_main;              //   false  Breakpoint in main was requested at command line
    i32                bnum;                    //   1  Breakpoint number for gdb
    mdbg::trace        trace;                   //
};
```

<!-- dev.mdmark  mdmark:MDSECTION  state:END_AUTO  param:Imdb -->

### Tests
<a href="#tests"></a>
<!-- dev.mdmark  mdmark:MDSECTION  state:BEG_AUTO  param:Tests -->
The following component tests are defined for `mdbg`.
These can be executed with `atf_comp <comptest> -v`
|Comptest|Comment|
|---|---|
|[mdbg.OutOfOrderArgs](/test/atf_comp/mdbg.OutOfOrderArgs)||
|[mdbg.Smoke](/test/atf_comp/mdbg.Smoke)||
|[mdbg.SmokeBreak](/test/atf_comp/mdbg.SmokeBreak)||
|[mdbg.SmokeBreak2](/test/atf_comp/mdbg.SmokeBreak2)||

<!-- dev.mdmark  mdmark:MDSECTION  state:END_AUTO  param:Tests -->

