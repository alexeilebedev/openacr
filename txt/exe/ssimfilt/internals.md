## ssimfilt - Internals


### Table Of Contents
<a href="#table-of-contents"></a>
<!-- dev.mdmark  mdmark:MDSECTION  state:BEG_AUTO  param:Toc -->
* [Description](#description)
* [Sources](#sources)
* [Dependencies](#dependencies)
* [In Memory DB](#in-memory-db)
* [Tests](#tests)

<!-- dev.mdmark  mdmark:MDSECTION  state:END_AUTO  param:Toc -->

### Description
<a href="#description"></a>
<!-- dev.mdmark  mdmark:MDSECTION  state:BEG_AUTO  param:Description -->
for usage, see [ssimfilt - Tuple utility](/txt/exe/ssimfilt/README.md)

<!-- dev.mdmark  mdmark:MDSECTION  state:END_AUTO  param:Description -->

### Sources
<a href="#sources"></a>
<!-- dev.mdmark  mdmark:MDSECTION  state:BEG_AUTO  param:Sources -->
The source code license is GPL
The following source files are part of this tool:

|Source File|Comment|
|---|---|
|[cpp/gen/ssimfilt_gen.cpp](/cpp/gen/ssimfilt_gen.cpp)||
|[cpp/ssimfilt.cpp](/cpp/ssimfilt.cpp)||
|[include/gen/ssimfilt_gen.h](/include/gen/ssimfilt_gen.h)||
|[include/gen/ssimfilt_gen.inl.h](/include/gen/ssimfilt_gen.inl.h)||
|[include/ssimfilt.h](/include/ssimfilt.h)||

<!-- dev.mdmark  mdmark:MDSECTION  state:END_AUTO  param:Sources -->

### Dependencies
<a href="#dependencies"></a>
<!-- dev.mdmark  mdmark:MDSECTION  state:BEG_AUTO  param:Dependencies -->
The build target depends on the following libraries
|Target|Comment|
|---|---|
|[algo_lib](/txt/lib/algo_lib/README.md)|Support library for all executables|
|[lib_ctype](/txt/lib/lib_ctype/README.md)|Helpful library for reading/writing ctypes as text tuples|
|[lib_json](/txt/lib/lib_json/README.md)|Full json support library|

<!-- dev.mdmark  mdmark:MDSECTION  state:END_AUTO  param:Dependencies -->

### In Memory DB
<a href="#in-memory-db"></a>
<!-- dev.mdmark  mdmark:MDSECTION  state:BEG_AUTO  param:Imdb -->
`ssimfilt` generated code creates the tables below.
All allocations are done through global `ssimfilt::_db` [ssimfilt.FDb](#ssimfilt-fdb) structure
|Ctype|Ssimfile|Create|Access|
|---|---|---|---|
|[ssimfilt.FDb](#ssimfilt-fdb)||FDb._db (Global)|
|[ssimfilt.FUnstablefld](#ssimfilt-funstablefld)|[dev.unstablefld](/txt/ssimdb/dev/unstablefld.md)|FDb.unstablefld (Lary)|unstablefld (Lary, by rowid)|ind_unstablefld (Thash, hash field field)|
|[ssimfilt.KVRegx](#ssimfilt-kvregx)||FDb.matchfield (Lary)|FDb.selfield (Lary)|matchfield (Lary, by rowid)|selfield (Lary, by rowid)|

#### ssimfilt.FDb - In-memory database for ssimfilt
<a href="#ssimfilt-fdb"></a>

#### ssimfilt.FDb Fields
<a href="#ssimfilt-fdb-fields"></a>
|Field|[Type](/txt/ssimdb/dmmeta/ctype.md)|[Reftype](/txt/ssimdb/dmmeta/reftype.md)|Default|Comment|
|---|---|---|---|---|
|ssimfilt.FDb._db|[ssimfilt.FDb](/txt/exe/ssimfilt/internals.md#ssimfilt-fdb)|[Global](/txt/exe/amc/reftypes.md#global)|||
|ssimfilt.FDb.cmdline|[command.ssimfilt](/txt/protocol/command/README.md#command-ssimfilt)|[Val](/txt/exe/amc/reftypes.md#val)|||
|ssimfilt.FDb.tuple|[algo.Tuple](/txt/protocol/algo/Tuple.md)|[Lary](/txt/exe/amc/reftypes.md#lary)||Accumulated tuples|
|ssimfilt.FDb.matchfield|[ssimfilt.KVRegx](/txt/exe/ssimfilt/internals.md#ssimfilt-kvregx)|[Lary](/txt/exe/amc/reftypes.md#lary)||Input tuple filter. Comes from cmdline.match array|
|ssimfilt.FDb.selfield|[ssimfilt.KVRegx](/txt/exe/ssimfilt/internals.md#ssimfilt-kvregx)|[Lary](/txt/exe/amc/reftypes.md#lary)||Select fields for output|
|ssimfilt.FDb.csv_locked|bool|[Val](/txt/exe/amc/reftypes.md#val)||CSV header locked|
|ssimfilt.FDb.markdown|bool|[Val](/txt/exe/amc/reftypes.md#val)||Use Markdown output|
|ssimfilt.FDb.unstablefld|[ssimfilt.FUnstablefld](/txt/exe/ssimfilt/internals.md#ssimfilt-funstablefld)|[Lary](/txt/exe/amc/reftypes.md#lary)|||
|ssimfilt.FDb.ind_unstablefld|[ssimfilt.FUnstablefld](/txt/exe/ssimfilt/internals.md#ssimfilt-funstablefld)|[Thash](/txt/exe/amc/reftypes.md#thash)|||

#### Struct FDb
<a href="#struct-fdb"></a>
Generated by [amc](/txt/exe/amc/README.md) into [include/gen/ssimfilt_gen.h](/include/gen/ssimfilt_gen.h)
```
struct FDb { // ssimfilt.FDb: In-memory database for ssimfilt
    command::ssimfilt          cmdline;                         //
    algo::Tuple*               tuple_lary[32];                  // level array
    i32                        tuple_n;                         // number of elements in array
    ssimfilt::KVRegx*          matchfield_lary[32];             // level array
    i32                        matchfield_n;                    // number of elements in array
    ssimfilt::KVRegx*          selfield_lary[32];               // level array
    i32                        selfield_n;                      // number of elements in array
    bool                       csv_locked;                      //   false  CSV header locked
    bool                       markdown;                        //   false  Use Markdown output
    ssimfilt::FUnstablefld*    unstablefld_lary[32];            // level array
    i32                        unstablefld_n;                   // number of elements in array
    ssimfilt::FUnstablefld**   ind_unstablefld_buckets_elems;   // pointer to bucket array
    i32                        ind_unstablefld_buckets_n;       // number of elements in bucket array
    i32                        ind_unstablefld_n;               // number of elements in the hash table
    ssimfilt::trace            trace;                           //
};
```

#### ssimfilt.FUnstablefld - Fields that should be stripped from component test output because they contain timestamps etc.
<a href="#ssimfilt-funstablefld"></a>

#### ssimfilt.FUnstablefld Fields
<a href="#ssimfilt-funstablefld-fields"></a>
|Field|[Type](/txt/ssimdb/dmmeta/ctype.md)|[Reftype](/txt/ssimdb/dmmeta/reftype.md)|Default|Comment|
|---|---|---|---|---|
|ssimfilt.FUnstablefld.base|[dev.Unstablefld](/txt/ssimdb/dev/unstablefld.md)|[Base](/txt/ssimdb/dev/unstablefld.md)|||

#### Struct FUnstablefld
<a href="#struct-funstablefld"></a>
*Note:* field ``ssimfilt.FUnstablefld.base`` has reftype ``base`` so the fields of [dev.Unstablefld](/txt/ssimdb/dev/unstablefld.md) above are included into the resulting struct.

Generated by [amc](/txt/exe/amc/README.md) into [include/gen/ssimfilt_gen.h](/include/gen/ssimfilt_gen.h)
```
struct FUnstablefld { // ssimfilt.FUnstablefld
    ssimfilt::FUnstablefld*   ind_unstablefld_next;   // hash next
    algo::Smallstr100         field;                  //
    algo::Comment             comment;                //
    // func:ssimfilt.FUnstablefld..AssignOp
    inline ssimfilt::FUnstablefld& operator =(const ssimfilt::FUnstablefld &rhs) = delete;
    // func:ssimfilt.FUnstablefld..CopyCtor
    inline               FUnstablefld(const ssimfilt::FUnstablefld &rhs) = delete;
private:
    // func:ssimfilt.FUnstablefld..Ctor
    inline               FUnstablefld() __attribute__((nothrow));
    // func:ssimfilt.FUnstablefld..Dtor
    inline               ~FUnstablefld() __attribute__((nothrow));
    friend ssimfilt::FUnstablefld& unstablefld_Alloc() __attribute__((__warn_unused_result__, nothrow));
    friend ssimfilt::FUnstablefld* unstablefld_AllocMaybe() __attribute__((__warn_unused_result__, nothrow));
    friend void                 unstablefld_RemoveAll() __attribute__((nothrow));
    friend void                 unstablefld_RemoveLast() __attribute__((nothrow));
};
```

#### ssimfilt.KVRegx - Filters that must match input key/value pairs
<a href="#ssimfilt-kvregx"></a>

#### ssimfilt.KVRegx Fields
<a href="#ssimfilt-kvregx-fields"></a>
|Field|[Type](/txt/ssimdb/dmmeta/ctype.md)|[Reftype](/txt/ssimdb/dmmeta/reftype.md)|Default|Comment|
|---|---|---|---|---|
|ssimfilt.KVRegx.key|[algo.cstring](/txt/protocol/algo/cstring.md)|[RegxSql](/txt/exe/amc/reftypes.md#regxsql)|||
|ssimfilt.KVRegx.value|[algo.cstring](/txt/protocol/algo/cstring.md)|[RegxSql](/txt/exe/amc/reftypes.md#regxsql)|||

#### Struct KVRegx
<a href="#struct-kvregx"></a>
Generated by [amc](/txt/exe/amc/README.md) into [include/gen/ssimfilt_gen.h](/include/gen/ssimfilt_gen.h)
```
struct KVRegx { // ssimfilt.KVRegx: Filters that must match input key/value pairs
    algo_lib::Regx   key;     // Sql Regx
    algo_lib::Regx   value;   // Sql Regx
private:
    // func:ssimfilt.KVRegx..Ctor
    inline               KVRegx() __attribute__((nothrow));
    friend ssimfilt::KVRegx&    matchfield_Alloc() __attribute__((__warn_unused_result__, nothrow));
    friend ssimfilt::KVRegx*    matchfield_AllocMaybe() __attribute__((__warn_unused_result__, nothrow));
    friend void                 matchfield_RemoveAll() __attribute__((nothrow));
    friend void                 matchfield_RemoveLast() __attribute__((nothrow));
    friend ssimfilt::KVRegx&    selfield_Alloc() __attribute__((__warn_unused_result__, nothrow));
    friend ssimfilt::KVRegx*    selfield_AllocMaybe() __attribute__((__warn_unused_result__, nothrow));
    friend void                 selfield_RemoveAll() __attribute__((nothrow));
    friend void                 selfield_RemoveLast() __attribute__((nothrow));
};
```

<!-- dev.mdmark  mdmark:MDSECTION  state:END_AUTO  param:Imdb -->

### Tests
<a href="#tests"></a>
<!-- dev.mdmark  mdmark:MDSECTION  state:BEG_AUTO  param:Tests -->
The following component tests are defined for `ssimfilt`.
These can be executed with `atf_comp <comptest> -v`
|Comptest|Comment|
|---|---|
|[ssimfilt.Csv](/test/atf_comp/ssimfilt.Csv)||
|[ssimfilt.CsvField](/test/atf_comp/ssimfilt.CsvField)|CSV + field selection|
|[ssimfilt.FirstTag](/test/atf_comp/ssimfilt.FirstTag)|Lock typetag to first input tuple|
|[ssimfilt.Json](/test/atf_comp/ssimfilt.Json)|Convert test data to json|
|[ssimfilt.JsonRecursive](/test/atf_comp/ssimfilt.JsonRecursive)|Print Recursive json object|
|[ssimfilt.MatchField](/test/atf_comp/ssimfilt.MatchField)|Select fields by value|
|[ssimfilt.MatchTag](/test/atf_comp/ssimfilt.MatchTag)|Match typetag|
|[ssimfilt.SelectField](/test/atf_comp/ssimfilt.SelectField)|Select several fields|
|[ssimfilt.Stable](/test/atf_comp/ssimfilt.Stable)|Filter unstable fields|
|[ssimfilt.Table](/test/atf_comp/ssimfilt.Table)|Tabular output|

<!-- dev.mdmark  mdmark:MDSECTION  state:END_AUTO  param:Tests -->

