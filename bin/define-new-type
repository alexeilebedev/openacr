#!/usr/bin/env bash
# Copyright (C) 2023 AlgoRND
#
# License: GPL
# This program is free software: you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation, either version 3 of the License, or
# (at your option) any later version.
#
# This program is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU General Public License for more details.
#
# You should have received a copy of the GNU General Public License
# along with this program.  If not, see <https://www.gnu.org/licenses/>.
#
# todo: make this the default output of
# acr_ed -create -ctype <typename> -subset <underlyingtype> -anonfld
# add handling of anonfld to acr_ed
# - if underlying type has cfmt, add a cfmt
# - if underlying has small size, emit cheap_copy:Y

T=$1
ARG=$2
DFLT=${3:-0}
if [ "$ARG" == "" ]; then
    print "Usage: define-new-type <typename> <underlyingtype> [<dflt>=0]"
    exit 1
fi
cat << EOF
dmmeta.ctype  ctype:$T  comment:""
dmmeta.cpptype  ctype:$T  ctor:Y  dtor:N  cheap_copy:Y
dmmeta.field  field:$T.value     arg:$ARG  reftype:Val  dflt:'$DFLT'  comment:""
dmmeta.anonfld  field:$T.value  comment:""
dmmeta.cfmt  cfmt:$T.String  printfmt:Raw  read:Y  print:Y  sep:""  genop:Y  comment:""
EOF
